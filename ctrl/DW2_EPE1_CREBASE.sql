-- MySQL Script generated by MySQL Workbench
-- Mon Mar 31 22:55:24 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema dw2_epe1
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `dw2_epe1` ;

-- -----------------------------------------------------
-- Schema dw2_epe1
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `dw2_epe1` DEFAULT CHARACTER SET utf8mb4 ;
USE `dw2_epe1` ;

-- -----------------------------------------------------
-- Table `dw2_epe1`.`tipo_item`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `dw2_epe1`.`tipo_item` (
  `id_tipo` CHAR(5) NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `es_privado` TINYINT NOT NULL DEFAULT 0,
  PRIMARY KEY (`id_tipo`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `dw2_epe1`.`seccion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `dw2_epe1`.`seccion` (
  `id_seccion` CHAR(10) NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `orden` INT UNSIGNED NULL,
  PRIMARY KEY (`id_seccion`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `dw2_epe1`.`tipo_parametro`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `dw2_epe1`.`tipo_parametro` (
  `id_param` VARCHAR(30) NOT NULL,
  `nombre` VARCHAR(75) NOT NULL,
  `tipo_dato` ENUM('string', 'boolean', 'date', 'time', 'number') NOT NULL DEFAULT 'string',
  `valor_defecto` VARCHAR(255) NULL,
  PRIMARY KEY (`id_param`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `dw2_epe1`.`item`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `dw2_epe1`.`item` (
  `id_item` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `id_seccion` CHAR(10) NOT NULL,
  `id_tipo` CHAR(5) NOT NULL,
  `id_item_padre` INT UNSIGNED NOT NULL,
  `codigo` VARCHAR(45) NOT NULL,
  `nombre` VARCHAR(150) NOT NULL,
  `orden` INT UNSIGNED NOT NULL DEFAULT 0,
  `fecha_creacion` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP(),
  PRIMARY KEY (`id_item`),
  UNIQUE INDEX `codigo_UNIQUE` (`codigo` ASC) VISIBLE,
  INDEX `fk_item_seccion_idx` (`id_seccion` ASC) VISIBLE,
  INDEX `fk_item_tipo_item1_idx` (`id_tipo` ASC) VISIBLE,
  INDEX `fk_item_item1_idx` (`id_item_padre` ASC) VISIBLE,
  CONSTRAINT `fk_item_seccion`
    FOREIGN KEY (`id_seccion`)
    REFERENCES `dw2_epe1`.`seccion` (`id_seccion`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_item_tipo_item1`
    FOREIGN KEY (`id_tipo`)
    REFERENCES `dw2_epe1`.`tipo_item` (`id_tipo`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_item_item1`
    FOREIGN KEY (`id_item_padre`)
    REFERENCES `dw2_epe1`.`item` (`id_item`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `dw2_epe1`.`parametro_item`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `dw2_epe1`.`parametro_item` (
  `id_item` INT UNSIGNED NOT NULL,
  `id_param` VARCHAR(30) NOT NULL,
  `valor` VARCHAR(255) NULL,
  PRIMARY KEY (`id_item`, `id_param`),
  INDEX `fk_item_tipo_parametro_tipo_parametro1_idx` (`id_param` ASC) VISIBLE,
  INDEX `fk_item_tipo_parametro_item1_idx` (`id_item` ASC) VISIBLE,
  CONSTRAINT `fk_item_tipo_parametro_item1`
    FOREIGN KEY (`id_item`)
    REFERENCES `dw2_epe1`.`item` (`id_item`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_item_tipo_parametro_tipo_parametro1`
    FOREIGN KEY (`id_param`)
    REFERENCES `dw2_epe1`.`tipo_parametro` (`id_param`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;

USE `dw2_epe1` ;

-- -----------------------------------------------------
-- Placeholder table for view `dw2_epe1`.`vw_items`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `dw2_epe1`.`vw_items` (`id_item` INT, `id_seccion` INT, `id_tipo` INT, `id_item_padre` INT, `codigo` INT, `nombre` INT, `orden` INT, `fecha_creacion` INT, `tiene_hijos` INT);

-- -----------------------------------------------------
-- View `dw2_epe1`.`vw_items`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dw2_epe1`.`vw_items`;
USE `dw2_epe1`;
CREATE  OR REPLACE VIEW `vw_items` AS
 SELECT
  it.*,
  IF((SELECT COUNT(*) FROM item h WHERE h.id_item_padre = it.id_item) > 0, 1, 0) AS tiene_hijos 
 FROM item it;
CREATE USER 'dw2_epe1' IDENTIFIED BY 'dw2_epe1';

GRANT SELECT ON TABLE `dw2_epe1`.* TO 'dw2_epe1';

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `dw2_epe1`.`tipo_item`
-- -----------------------------------------------------
START TRANSACTION;
USE `dw2_epe1`;
INSERT INTO `dw2_epe1`.`tipo_item` (`id_tipo`, `nombre`, `es_privado`) VALUES ('post', 'Publicación', 0);
INSERT INTO `dw2_epe1`.`tipo_item` (`id_tipo`, `nombre`, `es_privado`) VALUES ('form', 'Formulario', 0);
INSERT INTO `dw2_epe1`.`tipo_item` (`id_tipo`, `nombre`, `es_privado`) VALUES ('field', 'Campo de Formulario', 0);
INSERT INTO `dw2_epe1`.`tipo_item` (`id_tipo`, `nombre`, `es_privado`) VALUES ('msg', 'Mensaje', 1);

COMMIT;


-- -----------------------------------------------------
-- Data for table `dw2_epe1`.`seccion`
-- -----------------------------------------------------
START TRANSACTION;
USE `dw2_epe1`;
INSERT INTO `dw2_epe1`.`seccion` (`id_seccion`, `nombre`, `orden`) VALUES ('home', 'Inicio', 1);
INSERT INTO `dw2_epe1`.`seccion` (`id_seccion`, `nombre`, `orden`) VALUES ('project', 'Proyectos', 2);
INSERT INTO `dw2_epe1`.`seccion` (`id_seccion`, `nombre`, `orden`) VALUES ('skill', 'Habilidades', 3);
INSERT INTO `dw2_epe1`.`seccion` (`id_seccion`, `nombre`, `orden`) VALUES ('experience', 'Experiencia', 4);
INSERT INTO `dw2_epe1`.`seccion` (`id_seccion`, `nombre`, `orden`) VALUES ('contact', 'Contacto', 5);

COMMIT;


-- -----------------------------------------------------
-- Data for table `dw2_epe1`.`tipo_parametro`
-- -----------------------------------------------------
START TRANSACTION;
USE `dw2_epe1`;
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('descripcion', 'Descripción', 'string', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('url_text', 'Texto de Enlace', 'string', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('url_value', 'Dirección de Enlace', 'string', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('img_portada', 'Foto Portada', 'string', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('field_type', 'Tipo de Campo', 'string', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('field_name', 'Nombre de Campo', 'string', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('field_length', 'Largo de Campo', 'number', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('field_required', 'Campo es Requerido', 'boolean', NULL);
INSERT INTO `dw2_epe1`.`tipo_parametro` (`id_param`, `nombre`, `tipo_dato`, `valor_defecto`) VALUES ('url_target', 'Destino de Enlace', 'string', NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `dw2_epe1`.`item`
-- -----------------------------------------------------
START TRANSACTION;
USE `dw2_epe1`;
INSERT INTO `dw2_epe1`.`item` (`id_item`, `id_seccion`, `id_tipo`, `id_item_padre`, `codigo`, `nombre`, `orden`, `fecha_creacion`) VALUES (1, 'home', 'post', 0, 'presentacion', 'Le damos la bienvenida a nuestro portafolio', 1, DEFAULT);
INSERT INTO `dw2_epe1`.`item` (`id_item`, `id_seccion`, `id_tipo`, `id_item_padre`, `codigo`, `nombre`, `orden`, `fecha_creacion`) VALUES (2, 'contact', 'form', 0, 'contact-form', 'Formulario de Contacto', 1, DEFAULT);
INSERT INTO `dw2_epe1`.`item` (`id_item`, `id_seccion`, `id_tipo`, `id_item_padre`, `codigo`, `nombre`, `orden`, `fecha_creacion`) VALUES (3, 'contact', 'field', 2, 'contact-form-field-name', 'Nombre', 1, DEFAULT);
INSERT INTO `dw2_epe1`.`item` (`id_item`, `id_seccion`, `id_tipo`, `id_item_padre`, `codigo`, `nombre`, `orden`, `fecha_creacion`) VALUES (4, 'contact', 'field', 2, 'contact-form-field-message', 'Mensaje', 3, DEFAULT);

COMMIT;


-- -----------------------------------------------------
-- Data for table `dw2_epe1`.`parametro_item`
-- -----------------------------------------------------
START TRANSACTION;
USE `dw2_epe1`;
INSERT INTO `dw2_epe1`.`parametro_item` (`id_item`, `id_param`, `valor`) VALUES (1, 'descripcion', 'Somos Jorge Corvalán y Carolina Casanova, profesionales del área informática, y estamos acá para ayudarle en su próximo proyecto digital.');
INSERT INTO `dw2_epe1`.`parametro_item` (`id_item`, `id_param`, `valor`) VALUES (1, 'img_portada', './vw/img/icon_solution.png');
INSERT INTO `dw2_epe1`.`parametro_item` (`id_item`, `id_param`, `valor`) VALUES (1, 'url_value', './?contact');
INSERT INTO `dw2_epe1`.`parametro_item` (`id_item`, `id_param`, `valor`) VALUES (1, 'url_text', 'Contáctenos');
INSERT INTO `dw2_epe1`.`parametro_item` (`id_item`, `id_param`, `valor`) VALUES (1, 'url_target', '_self');

COMMIT;

